<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <title>Quiz Contestant</title>

        <link href="css/nes.min.css" rel="stylesheet" />
        <link href="css/animate.css" rel="stylesheet" />
        <link href="css/style.css" rel="stylesheet" />

        <style>
            #teams { display: none; }
            #err { display: none; }
            #wait { display: none; }
            header h1 { font-size: 200%; }
        </style>
    </head>
    <body>
        <header>
            <h1>D3R Xmas Quiz!</h1>
        </header>

        <section id="err"></section>

        <section id="wait" class="loading">
            <p class="animated pulse infinite">Please Wait</p>
        </section>

        <section id="teams" class="container with-title">
            <h2 class="title">Select Team</h2>
            <div class="containers list" />
        </section>

        <script src="/socket.io/socket.io.js"></script>
        <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
        <script>
            $(function () {
                var socket = io('/contestant'),
                    cid    = window.localStorage.getItem('cid');

                console.log('My id: ' + cid);

                $('form').submit(function () {
                    socket.emit('chat message', $('#m').val());
                    $('#m').val('');
                    return false;
                });

                $('#c').on('click', function () {
                    console.log('Cleared ID');
                    window.localStorage.removeItem('cid');
                    cid = null;
                    // @todo(dave13h): send disconnect?
                });

                socket
                .on('teams list', function (teams) {
                    $('#teams .list').html('');
                    $(teams).each(function(k, v) {
                        $('#teams .list').append(
                            $('<button/>')
                                .addClass('btn')
                                .addClass('is-error')
                                .text(v)
                                .on('click', function() {
                                    $('#err').html("").hide();
                                    socket.emit('team join', k);
                                })
                        ).append("<br/>");
                    });
                    $('#teams').show();
                })
                .on('teams invalid', function () {
                    $('#err').html("Invalid Team Choice").show();
                })
                .on('wait', function() {
                    $('section').hide();
                    $('#wait').show();
                })
                .on('reconnect', function (msg) {
                    socket.emit('ident', cid);
                    console.log("Reconnected");
                })
                .on('connect', function (msg) {
                    socket.emit('ident', cid);
                    console.log("Connected");
                })
                .on('id', function (id) {
                    console.log('Got ID: ' + id);
                    cid = id;
                    window.localStorage.setItem('cid', cid);
                });
            });
        </script>
    </body>
</html>
