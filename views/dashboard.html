<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <title>Quiz Dashboard</title>

        <link href="css/nes.min.css" rel="stylesheet" />
        <link href="css/animate.css" rel="stylesheet" />
        <link href="css/style.css" rel="stylesheet" />

        <style>
            #answer_correct, #answer_wrong, #answer_losers { display: none; }

            #question {
                display: none;
                margin-left: auto;
                margin-right: auto;
                margin-top: 50px;
                width: 100%;
            }
            #question h1 {
                text-align: center;
                color: #fff;
                font-size: 200%;
            }

            #question div {
                margin-top: 25px;
                text-align: center;
                height: 100%;
                width: 100%;
            }

            #question .content {
                color: #fff;
                font-size: 250%;
            }

            #teamoverlay, #answer_correct, #answer_wrong, #answer_losers  {
                padding-top: 150px;
                text-align: center;
                position: absolute;
                top: 0;
                left: 0;
                display: none;
                height: 100%;
                width: 100%;
                font-size: 500%;
                background-color: rgba(100, 100, 100, 0.85);
            }

            #answer_correct {
                box-shadow: inset 0 0 100px #090;
                background-color: rgba(100, 150, 100, 0.85);
                color: #4f4;
            }
            #answer_wrong {
                box-shadow: inset 0 0 100px #900;
                background-color: rgba(150, 100, 100, 0.85);
                color: #f44;
            }
            #answer_losers {
                box-shadow: inset 0 0 100px #900;
                background-color: rgba(150, 125, 100, 0.85);
                color: #f44;
            }

            #teamoverlay div {
                text-align: center;
            }

            #teamscores {
                display: none;
            }

            #teamscores { text-align: center; color: #fff; }
            #teamscores h1 { font-size: 350%; }
            #teamscorelist .teamscorelist { font-size: 200%; }
        </style>
    </head>
    <body>
        <header>
            <h1 class="animated zoomInDown">D3R Xmas Quiz!</h1>
        </header>

        <section id="loading" class="loading">
            <div class="animated zoomInDown delay-1s">
                <p class="animated pulse infinite">Waiting for server</p>
            </div>
        </section>

        <section id="question"></section>

        <section id="answer_correct">CORRECT!</section>
        <section id="answer_wrong">WRONG!</section>
        <section id="answer_losers">YOU ALL SUCK!</section>

        <section id="teamoverlay"></section>
        <section id="teamscores">
            <h1 class="animated zoomInDown">Scores!</h1>
            <div id="teamscorelist"></div>
        </section>

        <audio src="sounds/buzzer_default.wav" id="buzzer_default" preload></audio>
        <audio src="sounds/buzzer_wrong.wav" id="buzzer_wrong" preload></audio>
        <audio src="sounds/cheer.wav" id="cheer" preload></audio>
        <audio src="sounds/laugh.wav" id="laugh" preload></audio>

        <audio src="sounds/awesome.wav" id="awesome" preload></audio>
        <audio src="sounds/nextround.wav" id="nextround" preload></audio>
        <audio src="sounds/notyourbestmoment.wav" id="notyourbestmoment" preload></audio>
        <audio src="sounds/orderorder.wav" id="orderorder" preload></audio>

        <script src="/socket.io/socket.io.js"></script>
        <script src="js/jquery-1.11.1.js"></script>

        <script>
            $(function () {
                // Mmmm shimmy
                function toggleFullScreen() {
                    if (!document.fullscreenElement &&
                        !document.mozFullScreenElement &&
                        !document.webkitFullscreenElement &&
                        !document.msFullscreenElement) {
                        if (document.documentElement.requestFullscreen) {
                            document.documentElement.requestFullscreen();
                        } else if (document.documentElement.msRequestFullscreen) {
                            document.documentElement.msRequestFullscreen();
                        } else if (document.documentElement.mozRequestFullScreen) {
                            document.documentElement.mozRequestFullScreen();
                        } else if (document.documentElement.webkitRequestFullscreen) {
                            document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
                        }
                    } else {
                        if (document.exitFullscreen) {
                            document.exitFullscreen();
                        } else if (document.msExitFullscreen) {
                            document.msExitFullscreen();
                        } else if (document.mozCancelFullScreen) {
                            document.mozCancelFullScreen();
                        } else if (document.webkitExitFullscreen) {
                            document.webkitExitFullscreen();
                        }
                    }
                }
                document.addEventListener("keypress", function(e) {
                    if (e.keyCode === 102) {
                        toggleFullScreen();
                    }
                }, false);

                var socket = io.connect('/dashboard'),
                    wrongTimer = null;

                socket.on('question play', function (msg) {
                    $('header').hide();
                    $('section').hide();
                    $('#question').html('');

                    $('#question')
                    .append(
                        $('<h1/>')
                            .addClass('animated')
                            .addClass('zoomInDown')
                            .html(msg.round)
                    )
                    .append(
                        $('<div />').append(
                            $('<span />')
                                .addClass('content')
                                .addClass('animated')
                                .addClass('zoomInDown')
                                .addClass('delay-1s')
                                .html(msg.question.text)
                        )
                    ).show();
                });

                socket.on('sound play', function (sound) {
                    $('#' + sound.sound)[0].play();
                });

                socket.on('question buzzed', function (event) {
                    $('#' + event.sound)[0].play();

                    $('#teamoverlay').html('').append(
                        $('<div />')
                            .addClass('animated')
                            .addClass('zoomInDown')
                            .html(event.team.name)
                    ).show();
                })
                .on('question wrong', function (event) {
                    $('#' + event.sound)[0].play();
                    $('#teamoverlay').html('').hide();
                    $('#answer_wrong').show();

                    wrongTimer = window.setTimeout(
                        function() {
                            $('#answer_wrong').hide();
                        },
                        3000
                    );
                })
                .on('question correct', function (event) {
                    window.clearTimeout(wrongTimer);
                    $('#' + event.sound)[0].play();
                    $('#teamoverlay').html('').hide();
                    $('#answer_correct').show();
                })
                .on('question losers', function (event) {
                    window.clearTimeout(wrongTimer);
                    $('#' + event.sound)[0].play();
                    $('#teamoverlay').html('').hide();
                    $('#answer_losers').show();
                })
                .on('team scores', function(event) {

                    $('#teamscorelist').empty();
                    var teams = event.teams;
                    teams.sort((a, b) => parseFloat(b.points) - parseFloat(a.points));

                    var s = 1;
                    for (let t in teams) {
                        $('#teamscorelist').append(
                            '<div class="animated zoomInDown delay-' + s +
                            's" style="font-size: ' + (200 - (20 * s)) + '%;">' +
                            teams[t].name + ' (' + teams[t].points +
                            (teams[t].points == 1 ? ' point' : ' points') + ')</div>'
                        );
                        s++;
                    }

                    window.setTimeout(
                        function() {
                            $('section').hide();
                            $('#teamscores').show();
                        },
                        3000
                    );
                });
            });
        </script>
    </body>
</html>
